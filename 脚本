local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- 创建主界面
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "EnhancedTeleportGUI"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

-- 主按钮容器
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 400, 0, 40)  -- 宽度增加以容纳新按钮
mainFrame.Position = UDim2.new(0.5, -200, 0, 10)  -- 位置调整以适应新宽度
mainFrame.BackgroundTransparency = 1
mainFrame.Parent = screenGui

-- 坐标输入按钮
local inputBtn = Instance.new("TextButton")
inputBtn.Size = UDim2.new(0.15, 0, 1, 0)
inputBtn.Position = UDim2.new(0, 0, 0, 0)
inputBtn.Text = "坐标输入"
inputBtn.Font = Enum.Font.GothamBold
inputBtn.TextSize = 14
inputBtn.Parent = mainFrame

-- 新增：保存位置按钮
local saveLocationBtn = Instance.new("TextButton")
saveLocationBtn.Size = UDim2.new(0.15, 0, 1, 0)
saveLocationBtn.Position = UDim2.new(0.15, 0, 0, 0)
saveLocationBtn.Text = "保存位置"
saveLocationBtn.Font = Enum.Font.GothamBold
saveLocationBtn.TextSize = 14
saveLocationBtn.Parent = mainFrame

-- 新增：传送到保存位置按钮
local teleportToSavedBtn = Instance.new("TextButton")
teleportToSavedBtn.Size = UDim2.new(0.2, 0, 1, 0)
teleportToSavedBtn.Position = UDim2.new(0.3, 0, 0, 0)
teleportToSavedBtn.Text = "传送到保存位置"
teleportToSavedBtn.Font = Enum.Font.GothamBold
teleportToSavedBtn.TextSize = 12  -- 稍微减小字体以适应较长文本
teleportToSavedBtn.Parent = mainFrame



-- 坐标输入界面
local inputFrame = Instance.new("Frame")
inputFrame.Size = UDim2.new(0, 280, 0, 200)
inputFrame.Position = UDim2.new(0.5, -140, 0.5, -100)
inputFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
inputFrame.Visible = false
inputFrame.Parent = screenGui

-- 标题栏
local title = Instance.new("TextLabel")
title.Text = "输入坐标"
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
title.BorderSizePixel = 0
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Parent = inputFrame

-- 创建输入框函数
local function createInputField(yPosition, placeholder)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(0.8, 0, 0, 30)
    container.Position = UDim2.new(0.1, 0, 0, yPosition)
    container.BackgroundTransparency = 1
    container.Parent = inputFrame
    
    local textBox = Instance.new("TextBox")
    textBox.Size = UDim2.new(1, 0, 1, 0)
    textBox.Position = UDim2.new(0, 0, 0, 0)
    textBox.PlaceholderText = placeholder
    textBox.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
    textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    textBox.BorderSizePixel = 0
    textBox.Parent = container
    
    return textBox
end

-- 创建三个坐标输入框
local xInput = createInputField(40, "X坐标")
local yInput = createInputField(80, "Y坐标")
local zInput = createInputField(120, "Z坐标")

-- 传送按钮
local teleportBtn = Instance.new("TextButton")
teleportBtn.Text = "传送"
teleportBtn.Size = UDim2.new(0.8, 0, 0, 30)
teleportBtn.Position = UDim2.new(0.1, 0, 0, 160)
teleportBtn.Parent = inputFrame

-- 获取角色和根部件
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- 新增：保存的位置变量
local savedPosition = nil



-- 角色重生处理
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoidRootPart = newCharacter:WaitForChild("HumanoidRootPart")
end)

-- 按钮事件处理
inputBtn.MouseButton1Click:Connect(function()
    inputFrame.Visible = not inputFrame.Visible
end)

-- 新增：保存当前位置功能
saveLocationBtn.MouseButton1Click:Connect(function()
    if humanoidRootPart then
        savedPosition = humanoidRootPart.Position
        print("位置已保存: X:" .. savedPosition.X .. " Y:" .. savedPosition.Y .. " Z:" .. savedPosition.Z)
        -- 可以在这里添加UI反馈，比如显示一个提示消息
    end
end)

-- 新增：传送到保存的位置功能
teleportToSavedBtn.MouseButton1Click:Connect(function()
    if humanoidRootPart and savedPosition then
        humanoidRootPart.CFrame = CFrame.new(savedPosition)
        print("已传送到保存的位置")
    else
        print("没有保存的位置可传送")
    end
end)

teleportBtn.MouseButton1Click:Connect(function()
    local x = tonumber(xInput.Text) or 0
    local y = tonumber(yInput.Text) or 0
    local z = tonumber(zInput.Text) or 0
    
    if humanoidRootPart then
        humanoidRootPart.CFrame = CFrame.new(Vector3.new(x, y, z))
        inputFrame.Visible = false
    end
end)

--增加一个显示坐标的功能local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- 创建界面
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CoordinateDisplay"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

-- 坐标显示标签
local coordLabel = Instance.new("TextLabel")
coordLabel.Size = UDim2.new(0, 200, 0, 40)
coordLabel.Position = UDim2.new(1, -220, 0, 10)  -- 右上角位置
coordLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
coordLabel.BackgroundTransparency = 0.7
coordLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
coordLabel.Text = "X:0.0 Y:0.0 Z:0.0"
coordLabel.TextSize = 14
coordLabel.Active = true
coordLabel.Draggable = true  -- 允许拖动
coordLabel.Parent = screenGui

-- 获取角色部件
local function getCharacterParts()
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    return character, humanoidRootPart
end

-- 初始化角色部件
local character, humanoidRootPart = getCharacterParts()

-- 更新坐标函数
local function updateCoords()
    if humanoidRootPart and humanoidRootPart:IsDescendantOf(game) then
        local pos = humanoidRootPart.Position
        coordLabel.Text = string.format("X:%.1f Y:%.1f Z:%.1f", pos.X, pos.Y, pos.Z)
    end
end

-- 角色重生处理
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoidRootPart = newCharacter:WaitForChild("HumanoidRootPart")
end)

-- 实时更新坐标
RunService.RenderStepped:Connect(updateCoords)
